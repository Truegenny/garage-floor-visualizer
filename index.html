<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Garage Floor Visualizer</title>
  <link rel="stylesheet" href="style.css?v=1.4.0">
</head>
<body>
  <div id="app">
    <aside id="sidebar">
      <div class="header-row">
        <h1>Garage Floor Planner</h1>
        <div class="header-right">
          <span class="version">v1.4.0</span>
          <button id="btn-info" class="info-btn" title="Changelog">i</button>
        </div>
      </div>

      <!-- Auth bar: shown when logged in -->
      <div id="user-bar" class="panel user-bar" style="display:none">
        <span id="user-email" class="user-email"></span>
        <button id="btn-logout" class="btn btn-sm">Logout</button>
      </div>

      <!-- Login button: shown when logged out -->
      <div id="login-bar" class="panel">
        <button id="btn-show-auth" class="btn primary full">Login / Register</button>
      </div>

      <!-- Floor Plans panel: shown when logged in -->
      <section id="plans-panel" class="panel" style="display:none">
        <h2>Floor Plans</h2>
        <div class="plans-actions">
          <button id="btn-save-plan" class="btn primary">Save</button>
          <button id="btn-save-as-new" class="btn">Save As New</button>
        </div>
        <div id="plans-list" class="plans-list"></div>
        <p id="plans-empty" class="plans-empty" style="display:none">No saved plans yet.</p>
      </section>

      <section class="panel">
        <h2>Room Size</h2>
        <div class="dim-row">
          <label>Width</label>
          <input type="number" id="room-w-ft" value="20" min="1" max="100"> ft
          <input type="number" id="room-w-in" value="0" min="0" max="11"> in
        </div>
        <div class="dim-row">
          <label>Depth</label>
          <input type="number" id="room-d-ft" value="20" min="1" max="100"> ft
          <input type="number" id="room-d-in" value="0" min="0" max="11"> in
        </div>
        <button id="btn-update-room" class="btn primary">Update Room</button>
      </section>

      <section class="panel">
        <h2>Add Objects</h2>
        <div id="catalog-tabs" class="tab-bar"></div>
        <div id="catalog-list" class="catalog-list"></div>
      </section>

      <section class="panel">
        <h2>Custom Object</h2>
        <input type="text" id="custom-name" placeholder="Name" class="input-full">
        <div class="dim-row">
          <label>W</label>
          <input type="number" id="custom-w-ft" value="0" min="0"> ft
          <input type="number" id="custom-w-in" value="24" min="0"> in
        </div>
        <div class="dim-row">
          <label>D</label>
          <input type="number" id="custom-d-ft" value="0" min="0"> ft
          <input type="number" id="custom-d-in" value="24" min="0"> in
        </div>
        <div class="color-row">
          <label>Color</label>
          <input type="color" id="custom-color" value="#22c55e">
        </div>
        <button id="btn-add-custom" class="btn primary">Add Custom</button>
      </section>

      <section class="panel" id="selected-panel" style="display:none">
        <h2>Edit Selected</h2>
        <input type="text" id="edit-name" class="input-full">
        <div class="dim-row">
          <label>W</label>
          <input type="number" id="edit-w-ft" min="0"> ft
          <input type="number" id="edit-w-in" min="0"> in
        </div>
        <div class="dim-row">
          <label>D</label>
          <input type="number" id="edit-d-ft" min="0"> ft
          <input type="number" id="edit-d-in" min="0"> in
        </div>
        <div class="color-row">
          <label>Color</label>
          <input type="color" id="edit-color" value="#3b82f6">
        </div>
        <p id="sel-rotation" class="sel-info dim"></p>
        <button id="btn-apply-edit" class="btn primary">Apply Changes</button>
        <div class="btn-row">
          <button id="btn-rotate" class="btn">Rotate 90&deg;</button>
          <button id="btn-delete" class="btn danger">Delete</button>
        </div>
      </section>

      <section class="panel help">
        <h2>Controls</h2>
        <ul>
          <li>Click item to add to room</li>
          <li>Drag object to move</li>
          <li><kbd>R</kbd> Rotate selected</li>
          <li><kbd>Del</kbd> Delete selected</li>
          <li>Scroll to zoom</li>
          <li>Drag empty space to pan</li>
        </ul>
      </section>

      <section class="panel">
        <button id="btn-clear" class="btn danger full">Clear All Objects</button>
      </section>
    </aside>

    <main id="canvas-container">
      <canvas id="canvas"></canvas>
      <div id="controls">
        <button id="btn-zoom-in" class="ctrl-btn">+</button>
        <button id="btn-zoom-out" class="ctrl-btn">&minus;</button>
        <button id="btn-fit" class="ctrl-btn">Fit</button>
        <label class="ctrl-label"><input type="checkbox" id="chk-snap" checked> Snap</label>
        <label class="ctrl-label"><input type="checkbox" id="chk-labels" checked> Labels</label>
        <div class="ctrl-sep"></div>
        <button id="btn-export" class="ctrl-btn export-btn" title="Export as PNG">PNG</button>
      </div>
    </main>
  </div>

  <!-- Changelog modal -->
  <div id="modal-overlay" class="modal-overlay" style="display:none">
    <div class="modal">
      <div class="modal-header">
        <h2>Garage Floor Planner <span class="version">v1.4.0</span></h2>
        <button id="btn-modal-close" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <h3>v1.4.0</h3>
        <ul>
          <li>User accounts with login/register</li>
          <li>Cloud save: multiple named floor plans stored on server</li>
          <li>Auto-save to server while logged in (2s debounce)</li>
          <li>Import existing localStorage layout on first login</li>
          <li>Save, Save As New, Rename, Delete plans</li>
          <li>localStorage still works when not logged in</li>
        </ul>
        <h3>v1.3.0</h3>
        <ul>
          <li>Visual polish: rounded corners, drop shadows, inner highlights on all objects</li>
          <li>Vehicle detail rendering: car top-down view with wheels, windshield, rear window, roof outline</li>
          <li>Motorcycle detail rendering: wheels, handlebars, frame centerline</li>
          <li>Improved walls: thick walls with depth/highlight effect</li>
          <li>Dimension lines with tick marks on room edges</li>
          <li>Export to PNG: download current view as image</li>
        </ul>
        <h3>v1.2.0</h3>
        <ul>
          <li>Added version number and changelog</li>
          <li>Added info button</li>
        </ul>
        <h3>v1.1.0</h3>
        <ul>
          <li>Added Lifts category: HF Motorcycle Lift, JEGS Motorcycle Lift, Car Scissor Lifts (mid-rise &amp; full-rise)</li>
          <li>Color picker for custom objects</li>
          <li>Edit placed objects: change name, dimensions, and color after placement</li>
        </ul>
        <h3>v1.0.0</h3>
        <ul>
          <li>Initial release</li>
          <li>Custom room size in feet/inches</li>
          <li>Vehicles: 2021 Honda Passport, 2023 KTM Duke 890 R, 2021 Honda Grom</li>
          <li>DeWalt woodworking tools: 13" Planer, 10" Table Saw, 12" Miter Saw, Scroll Saw, and more</li>
          <li>Tool storage: US General carts/cabinets, Husky tool chests, HF service cart</li>
          <li>Steel and plastic shelving in common sizes</li>
          <li>Custom objects with user-defined dimensions</li>
          <li>Drag to move, rotate, delete, zoom, pan</li>
          <li>Grid snapping and label toggles</li>
          <li>Auto-save layout to browser storage</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Auth modal -->
  <div id="auth-modal" class="modal-overlay" style="display:none">
    <div class="modal">
      <div class="modal-header">
        <h2 id="auth-modal-title">Login</h2>
        <button id="btn-auth-close" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="auth-form" autocomplete="on">
          <div class="auth-field">
            <label for="auth-email">Email</label>
            <input type="email" id="auth-email" class="input-full" required autocomplete="email">
          </div>
          <div class="auth-field">
            <label for="auth-password">Password</label>
            <input type="password" id="auth-password" class="input-full" required autocomplete="current-password">
          </div>
          <p id="auth-error" class="auth-error" style="display:none"></p>
          <button type="submit" id="btn-auth-submit" class="btn primary full">Login</button>
        </form>
        <p class="auth-toggle">
          <span id="auth-toggle-text">Don't have an account?</span>
          <a href="#" id="auth-toggle-link">Register</a>
        </p>
      </div>
    </div>
  </div>

  <script src="app.js?v=1.4.0"></script>
</body>
</html>
